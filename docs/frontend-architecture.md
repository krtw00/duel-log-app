# フロントエンドアーキテクチャ

このドキュメントは、Duel Log Appのフロントエンドアーキテクチャについて記述します。

---

## 概要

フロントエンドは、Vue.js 3（Composition API）とTypeScriptをベースに構築されています。UIフレームワークにはVuetify 3を採用し、モダンでレスポンシブなデザインを実現しています。ビルドツールにはViteを使用し、高速な開発サーバーと最適化された本番ビルドを提供します。

## 技術スタック

- **フレームワーク**: Vue.js (Composition API)
- **言語**: TypeScript
- **ビルドツール**: Vite
- **UIフレームワーク**: Vuetify
- **状態管理**: Pinia
- **ルーティング**: Vue Router
- **HTTP通信**: Axios
- **チャート**: ApexCharts

---

## ディレクトリ構造

主要なディレクトリとその役割は以下の通りです。

```
frontend/
└── src/
    ├── assets/        # SCSSファイルや画像などの静的アセット
    ├── components/    # 再利用可能なVueコンポーネント
    │   ├── common/    # アプリケーション全体で使われる共通コンポーネント
    │   ├── duel/      # 対戦履歴関連のコンポーネント
    │   └── layout/    # AppBarなど、レイアウトを構成するコンポーネント
    ├── plugins/       # Vuetifyなどのプラグイン設定
    ├── router/        # Vue Routerによるルーティング設定
    ├── services/      # APIクライアントと通信ロジック
    ├── stores/        # Piniaによるグローバルな状態管理
    ├── types/         # TypeScriptの型定義
    ├── utils/         # 汎用的なユーティリティ関数
    ├── views/         # 各ページに対応するコンポーネント
    ├── App.vue        # アプリケーションのルートコンポーネント
    └── main.ts        # アプリケーションのエントリーポイント
```

---

## アーキテクチャの主要要素

### 1. コンポーネント設計

- **`views`**: 各URL（ページ）に対応するトップレベルのコンポーネントを配置します。これらのコンポーネントは、主にレイアウトの構成と、複数の`components`を組み合わせてページ全体を構築する責務を持ちます。
  - 例: `DashboardView.vue`, `DecksView.vue`
- **`components`**: 再利用可能なUI部品を配置します。`views`で利用されることを想定し、特定のページに依存しないように設計されています。
  - **`common`**: `LoadingOverlay`や`ToastNotification`など、アプリケーション全体で利用される汎用コンポーネント。
  - **`layout`**: `AppBar`など、ページの骨格となるレイアウト用コンポーネント。
  - **`duel`**: `DuelTable`や`DuelFormDialog`など、対戦履歴という特定のドメインに特化したコンポーネント。

### 2. 状態管理 (Pinia)

グローバルな状態管理にはPiniaを使用しています。`src/stores/`配下に、機能ごとにストアを定義します。

- **`auth.ts`**: ユーザーの認証状態（ログインしているか、ユーザー情報など）を管理します。ログイン、ログアウト、ユーザー情報取得などのアクションを提供します。
- **`notification.ts`**: 画面に表示されるトースト通知の状態（メッセージ、色、表示状態）を管理します。
- **`loading.ts`**: グローバルなローディングオーバーレイの表示状態を管理します。

各コンポーネントは、これらのストアから状態をリアクティブに取得し、必要に応じてアクションを呼び出すことで状態を変更します。

### 3. ルーティング (Vue Router)

`src/router/index.ts`で、アプリケーションのルーティングを定義しています。

- **ナビゲーションガード (`router.beforeEach`)**: ページ遷移のたびに、ユーザーの認証状態をチェックします。
  - `meta: { requiresAuth: true }` が設定されたルートに未認証のユーザーがアクセスしようとすると、ログインページにリダイレクトします。
  - アプリケーションの初回読み込み時には、`authStore.fetchUser()`を呼び出して、クッキーを元にユーザーのログイン状態を復元しようと試みます。

### 4. API通信 (Axios)

`src/services/api.ts`で、Axiosのインスタンスを生成し、バックエンドAPIとの通信設定を一元管理しています。

- **ベースURL**: 環境変数 `VITE_API_URL` からAPIのベースURLを設定します。
- **認証**: `withCredentials: true` を設定し、リクエスト時に自動的にHttpOnlyクッキー（認証トークン）が送信されるようにしています。
- **エラーハンドリング**: Axiosのインターセプターを使用して、APIからのエラーレスポンス（401 Unauthorizedなど）をグローバルにハンドリングし、必要に応じてログインページへのリダイレクトや、エラーメッセージの通知を行います。

### 5. 型定義 (TypeScript)

`src/types/index.ts`に、アプリケーション全体で使用されるデータ構造の型定義（`User`, `Deck`, `Duel`など）を集約しています。これにより、コンポーネントやストア、サービス間で安全なデータの受け渡しを実現しています。
