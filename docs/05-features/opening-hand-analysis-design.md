# 初手カード勝率分析設計

デッキ内カードを管理し、初手カード情報から勝率を分析する機能。

> **❌ 未実装:** 計画中機能

---

## 目的

| 目的 | 説明 |
|------|------|
| 勝率傾向可視化 | 初手に特定カードを引いた際の勝率 |
| 先攻/後攻分析 | ターン順別の初手カード勝率 |
| 相性分析 | 相手デッキとの相性における影響 |
| デッキ最適化 | 構築改善のためのデータ提供 |

---

## 設計方針

| 項目 | 方針 |
|------|------|
| 機能ON/OFF | ユーザー設定でON/OFF（デフォルト: OFF） |
| データ整合性 | 外部キーで`deck_cards.id`を参照 |
| カード選択 | リストボックスからの選択のみ |

---

## 機能要件

### 1. デッキリスト管理

| 機能 | 説明 |
|------|------|
| カード登録 | 名前、枚数（1-3）、種別（モンスター/魔法/罠） |
| 一覧表示 | ソート、検索フィルター |
| 制約 | 1デッキ最大60枚 |

### 2. 初手カード記録

| 項目 | 仕様 |
|------|------|
| 表示条件 | デッキにカード登録あり |
| 入力方法 | リストボックス（複数選択） |
| 最大枚数 | 5枚 |
| 必須 | 任意 |

### 3. 勝率分析

| 統計項目 | 説明 |
|---------|------|
| カード別総合勝率 | 出現回数、勝利/敗北、勝率 |
| 先攻/後攻別勝率 | ターン順別の勝率差 |
| 相手テーマ別勝率 | カード × 相手デッキ |

### 4. 初動率計算（アドバンス）

| パターン | 説明 |
|---------|------|
| 1枚初動 | 単体で展開開始 |
| 2枚初動 | 特定2枚の組み合わせ |
| OR条件 | いずれか成立で初動成功 |

---

## データベース

### deck_cards テーブル

| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | PK |
| deck_id | INTEGER | FK (decks) |
| card_name | VARCHAR(100) | カード名 |
| quantity | INTEGER | 枚数 (1-3) |
| card_type | VARCHAR(20) | モンスター/魔法/罠 |

### opening_hand_cards テーブル

| カラム | 型 | 説明 |
|--------|-----|------|
| id | SERIAL | PK |
| duel_id | INTEGER | FK (duels) |
| deck_card_id | INTEGER | FK (deck_cards) |

---

## API

| エンドポイント | 説明 |
|---------------|------|
| `POST /decks/{id}/cards` | カード追加 |
| `GET /decks/{id}/cards` | カード一覧 |
| `PUT /deck-cards/{id}` | カード更新 |
| `DELETE /deck-cards/{id}` | カード削除 |
| `POST /duels` | 初手カード付き対戦記録 |
| `GET /statistics/opening-hand` | 初手カード統計 |

---

## 関連ドキュメント

| ドキュメント | 内容 |
|------------|------|
| @../04-data/data-model.md | DBスキーマ |
| @../02-architecture/backend-architecture.md | バックエンド構造 |
