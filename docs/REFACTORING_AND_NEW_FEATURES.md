# リファクタリングと追加要件の提案

## 1. リファクタリングの概要

これまでの機能追加に伴い、以下のリファクタリングを実施しました。

### バックエンド (`backend/`)

*   **`app/services/statistics_service.py`:**
    *   **共通クエリビルディング関数の導入:** `_build_base_duels_query` メソッドを導入し、`user_id` および `game_mode` によるデュエルクエリのフィルタリングロジックを共通化しました。これにより、`get_deck_distribution_monthly`, `get_deck_distribution_recent`, `get_matchup_chart`, `get_time_series_data` メソッド内の重複コードが削減され、保守性が向上しました。
    *   **`get_time_series_data` の修正:** レート/DC推移グラフの横軸を日付から対戦数に変更する要件に対応するため、時系列データの生成ロジックを修正しました。月のすべての日を補完するのではなく、実際にデュエルがあった時点のデータのみをプロットするように変更しました。

### フロントエンド (`frontend/`)

*   **`src/views/StatisticsView.vue`:**
    *   **時系列グラフオプションの初期化修正:** `lineChartOptions` を `computed` プロパティから通常のオブジェクト `lineChartBaseOptions` に変更し、`statisticsByMode` の初期化時にこれを参照するように修正しました。これにより、`computed` プロパティの不適切な使用を避け、コードの可読性と保守性を向上させました。
    *   **時系列グラフの横軸設定:** レート/DC推移グラフの横軸を日付から対戦数に変更するため、`xaxis.type` を `'numeric'` に、`xaxis.title` を `'対戦数'` に設定しました。

## 2. 追加要件の提案

現在のアプリケーションの機能に加えて、以下の追加要件を提案します。これらはユーザー体験の向上、機能の充実、およびアプリケーションの堅牢性強化に貢献すると考えられます。

### 2.1. 統計情報の詳細化

*   **各ゲームモードのサマリー統計カード:**
    *   各ゲームモードの統計タブ（RANK, RATE, EVENT, DC）に、ダッシュボード画面で表示されているような「総試合数」「勝率」「先攻勝率」「後攻勝率」「コイン勝率」などのサマリー統計カードを追加します。これにより、ユーザーは各ゲームモードの概要統計を素早く把握できるようになります。
*   **デッキ相性表の拡張:**
    *   デッキ相性表に、各デッキの「使用回数」「勝率」などの詳細情報を追加表示できるようにします。これにより、ユーザーはデッキごとのパフォーマンスをより深く分析できます。

### 2.2. デュエルデータのインポート/エクスポート機能

*   **CSV/JSON形式でのデータ操作:**
    *   ユーザーが自身のデュエルデータをCSVまたはJSON形式でインポート・エクスポートできる機能を提供します。これにより、データのバックアップ、他のツールとの連携、または一括でのデータ入力が可能となり、利便性が向上します。

### 2.3. 通知機能の強化

*   **リアルタイム通知システム:**
    *   新しいデュエルが追加された際、パスワードが変更された際、または重要なシステムイベントが発生した際に、ユーザーにリアルタイムで通知するシステムを導入します。これにより、ユーザーはアプリケーション内の重要な動きを見逃すことがなくなります。

### 2.4. ユーザー設定の追加

*   **パーソナライズオプション:**
    *   アプリケーションのテーマ切り替え（ライトモード/ダークモード）、表示言語の選択、通知設定のカスタマイズなど、ユーザーが自身の好みに合わせてアプリケーションを調整できる機能を追加します。

### 2.5. パフォーマンス改善

*   **大規模データ対応:**
    *   デュエルデータが大量になった場合でも、APIレスポンス速度が低下しないように、バックエンドにページネーション、インデックス最適化、クエリキャッシュなどのパフォーマンス改善策を導入します。

### 2.6. テストカバレッジの向上

*   **堅牢性の強化:**
    *   バックエンドのAPIエンドポイント、サービスロジック、データベース操作に対するユニットテストおよび結合テストを拡充します。
    *   フロントエンドの主要なコンポーネントや機能に対するユニットテストおよびE2Eテストを導入し、アプリケーション全体の品質と堅牢性を高めます。

---