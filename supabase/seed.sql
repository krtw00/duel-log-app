-- Seed data for local development
-- Test users (password: password123 for all)
-- These UUIDs are stable for consistent local development

-- Create auth users first (Supabase Auth schema)
INSERT INTO auth.users (
  id, instance_id, aud, role, email, encrypted_password,
  email_confirmed_at, created_at, updated_at,
  confirmation_token, recovery_token,
  email_change, email_change_token_new, email_change_token_current,
  phone_change, phone_change_token,
  reauthentication_token,
  raw_app_meta_data, raw_user_meta_data
)
VALUES
  ('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'test@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', '', '', '', '', '', '', '', '{"provider": "email", "providers": ["email"]}', '{"display_name": "testuser"}'),
  ('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'admin@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', '', '', '', '', '', '', '', '{"provider": "email", "providers": ["email"]}', '{"display_name": "admin"}'),
  ('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'debugger@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', '', '', '', '', '', '', '', '{"provider": "email", "providers": ["email"]}', '{"display_name": "debugger"}')
ON CONFLICT (id) DO NOTHING;

-- Create auth identities
INSERT INTO auth.identities (id, user_id, provider_id, provider, identity_data, last_sign_in_at, created_at, updated_at)
VALUES
  ('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'email', jsonb_build_object('sub', '00000000-0000-0000-0000-000000000001', 'email', 'test@example.com'), now(), now(), now()),
  ('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002', 'email', jsonb_build_object('sub', '00000000-0000-0000-0000-000000000002', 'email', 'admin@example.com'), now(), now(), now()),
  ('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', 'email', jsonb_build_object('sub', '00000000-0000-0000-0000-000000000003', 'email', 'debugger@example.com'), now(), now(), now())
ON CONFLICT (id) DO NOTHING;

-- Create app users
INSERT INTO public.users (id, email, display_name, is_admin, is_debugger)
VALUES
  ('00000000-0000-0000-0000-000000000001', 'test@example.com', 'testuser', true, true),
  ('00000000-0000-0000-0000-000000000002', 'admin@example.com', 'admin', true, false),
  ('00000000-0000-0000-0000-000000000003', 'debugger@example.com', 'debugger', false, true)
ON CONFLICT (id) DO NOTHING;

-- Create sample decks for testuser
-- Player decks
INSERT INTO public.decks (id, user_id, name, is_opponent_deck, is_generic, active)
VALUES
  ('10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '閃刀姫', false, false, true),
  ('10000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'ティアラメンツ', false, false, true),
  ('10000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'ラビュリンス', false, false, true)
ON CONFLICT (id) DO NOTHING;

-- Opponent decks (normal)
INSERT INTO public.decks (id, user_id, name, is_opponent_deck, is_generic, active)
VALUES
  ('10000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000001', 'スネークアイ', true, false, true),
  ('10000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', '粛声', true, false, true),
  ('10000000-0000-0000-0000-000000000006', '00000000-0000-0000-0000-000000000001', 'デモンスミス', true, false, true),
  ('10000000-0000-0000-0000-000000000007', '00000000-0000-0000-0000-000000000001', '炎王', true, false, true),
  ('10000000-0000-0000-0000-000000000008', '00000000-0000-0000-0000-000000000001', 'ユベル', true, false, true),
  ('10000000-0000-0000-0000-000000000009', '00000000-0000-0000-0000-000000000001', 'R-ACE', true, false, true),
  ('10000000-0000-0000-0000-00000000000a', '00000000-0000-0000-0000-000000000001', 'センチュリオン', true, false, true),
  ('10000000-0000-0000-0000-00000000000b', '00000000-0000-0000-0000-000000000001', 'ホルス', true, false, true)
ON CONFLICT (id) DO NOTHING;

-- Opponent decks (generic - should be sorted last)
INSERT INTO public.decks (id, user_id, name, is_opponent_deck, is_generic, active)
VALUES
  ('10000000-0000-0000-0000-0000000000f1', '00000000-0000-0000-0000-000000000001', '不明', true, true, true),
  ('10000000-0000-0000-0000-0000000000f2', '00000000-0000-0000-0000-000000000001', 'その他', true, true, true),
  ('10000000-0000-0000-0000-0000000000f3', '00000000-0000-0000-0000-000000000001', 'わからない', true, true, true),
  ('10000000-0000-0000-0000-0000000000f4', '00000000-0000-0000-0000-000000000001', '未確認デッキ', true, true, true)
ON CONFLICT (id) DO NOTHING;

-- Create sample duels for testuser (多数の対戦データ)
INSERT INTO public.duels (user_id, deck_id, opponent_deck_id, result, game_mode, is_first, won_coin_toss, rank, dueled_at)
VALUES
  -- 閃刀姫 vs 通常デッキ
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000004', 'win', 'RANK', true, true, 15, now() - interval '10 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000004', 'win', 'RANK', false, false, 15, now() - interval '10 days' + interval '1 hour'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000004', 'loss', 'RANK', true, true, 14, now() - interval '9 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000005', 'win', 'RANK', true, true, 15, now() - interval '9 days' + interval '2 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000005', 'win', 'RANK', false, false, 15, now() - interval '8 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000005', 'loss', 'RANK', true, true, 14, now() - interval '8 days' + interval '1 hour'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000005', 'win', 'RANK', false, true, 15, now() - interval '7 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000006', 'loss', 'RANK', false, false, 14, now() - interval '7 days' + interval '2 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000006', 'win', 'RANK', true, true, 15, now() - interval '6 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000007', 'win', 'RANK', true, true, 16, now() - interval '6 days' + interval '1 hour'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000007', 'loss', 'RANK', false, false, 15, now() - interval '5 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000008', 'win', 'RANK', true, true, 16, now() - interval '5 days' + interval '2 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000009', 'loss', 'RANK', false, false, 15, now() - interval '4 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000009', 'win', 'RANK', true, true, 16, now() - interval '4 days' + interval '1 hour'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-00000000000a', 'win', 'RANK', false, true, 17, now() - interval '3 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-00000000000b', 'loss', 'RANK', true, false, 16, now() - interval '3 days' + interval '2 hours'),

  -- 閃刀姫 vs ジェネリックデッキ（多め）
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f1', 'win', 'RANK', true, true, 16, now() - interval '2 days'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f1', 'loss', 'RANK', false, false, 15, now() - interval '2 days' + interval '1 hour'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f1', 'win', 'RANK', true, true, 16, now() - interval '2 days' + interval '2 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f1', 'win', 'RANK', false, true, 17, now() - interval '2 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f1', 'loss', 'RANK', true, false, 16, now() - interval '2 days' + interval '4 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f2', 'win', 'RANK', true, true, 17, now() - interval '1 day'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f2', 'loss', 'RANK', false, false, 16, now() - interval '1 day' + interval '1 hour'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f2', 'win', 'RANK', true, true, 17, now() - interval '1 day' + interval '2 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f2', 'win', 'RANK', false, true, 18, now() - interval '1 day' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f3', 'loss', 'RANK', true, false, 17, now() - interval '20 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f3', 'win', 'RANK', false, true, 18, now() - interval '19 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f3', 'loss', 'RANK', true, true, 17, now() - interval '18 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f4', 'win', 'RANK', true, true, 18, now() - interval '17 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f4', 'loss', 'RANK', false, false, 17, now() - interval '16 hours'),

  -- ティアラメンツ vs 通常デッキ
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000004', 'win', 'RANK', false, false, 14, now() - interval '9 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000004', 'win', 'RANK', true, true, 15, now() - interval '8 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000005', 'loss', 'RANK', false, false, 14, now() - interval '7 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000006', 'win', 'RANK', true, true, 15, now() - interval '6 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000007', 'loss', 'RANK', false, false, 14, now() - interval '5 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000008', 'win', 'RANK', true, true, 15, now() - interval '4 days' + interval '3 hours'),

  -- ティアラメンツ vs ジェネリックデッキ
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-0000000000f1', 'win', 'RANK', true, true, 15, now() - interval '3 days' + interval '3 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-0000000000f1', 'loss', 'RANK', false, false, 14, now() - interval '2 days' + interval '5 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-0000000000f2', 'win', 'RANK', true, true, 15, now() - interval '1 day' + interval '5 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-0000000000f2', 'loss', 'RANK', false, false, 14, now() - interval '15 hours'),

  -- ラビュリンス vs 通常デッキ (EVENT)
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000006', 'loss', 'EVENT', true, true, null, now() - interval '8 days' + interval '5 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000004', 'win', 'EVENT', false, false, null, now() - interval '7 days' + interval '5 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000009', 'win', 'EVENT', true, true, null, now() - interval '6 days' + interval '5 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-00000000000a', 'loss', 'EVENT', false, false, null, now() - interval '5 days' + interval '5 hours'),

  -- ラビュリンス vs ジェネリック (EVENT)
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-0000000000f1', 'win', 'EVENT', true, true, null, now() - interval '4 days' + interval '5 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-0000000000f3', 'loss', 'EVENT', false, false, null, now() - interval '3 days' + interval '5 hours'),

  -- 追加: 閃刀姫 でのRATE対戦
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000004', 'win', 'RATE', true, true, null, now() - interval '12 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000005', 'loss', 'RATE', false, false, null, now() - interval '11 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f1', 'win', 'RATE', true, true, null, now() - interval '10 hours'),
  ('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-0000000000f2', 'loss', 'RATE', false, false, null, now() - interval '9 hours');

-- Update RATE duels with rate_value
UPDATE public.duels SET rate_value = 1250.5 WHERE game_mode = 'RATE' AND result = 'win';
UPDATE public.duels SET rate_value = 1180.0 WHERE game_mode = 'RATE' AND result = 'loss';
