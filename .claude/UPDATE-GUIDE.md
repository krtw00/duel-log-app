# AI Context Documents - Update Guide

このファイルは、`.claude/` ディレクトリ内のAI向けドキュメント更新手順を説明します。

## 概要

`.claude/` ディレクトリには、Claude Code（AI）が参照する3つの統合ドキュメントが含まれています：

1. **coding-rules.md** - プロジェクトのコーディング標準と規約
2. **rules-checklist.md** - PR提出前チェックリスト
3. **sources.md** - トレーサビリティドキュメント（参照元の記録）

これらのドキュメントは `.gitignore` で git 追跡対象外に設定されており、リポジトリ履歴を汚さずに AI コンテキストを管理できます。

## 更新対象のソースドキュメント

以下のファイルが変更されたときに、AI コンテキスト文書を更新してください：

### バックエンド関連
- `backend/CLAUDE.md` （プロジェクト固有の指示）
- `docs/development-guide.md` （開発ガイドライン）
- `docs/coding-conventions.md` （コーディング規約）
- `docs/error-handling.md` （エラーハンドリングパターン）
- `docs/backend-architecture.md` （バックエンドアーキテクチャ）
- `backend/requirements.txt` （依存パッケージ）

### フロントエンド関連
- `frontend/package.json` （依存パッケージと scripts）
- `frontend/tsconfig.json` （TypeScript 設定）
- `.pre-commit-config.yaml` （プリコミットフック）

### トップレベル
- `README.md` （プロジェクト概要）
- `pyproject.toml` （Python プロジェクト設定）

## 更新タイミング

以下のタイミングで更新を推奨します：

1. **コーディング標準変更時**
   - 新しいフォーマッター/リンターの導入
   - 命名規則の変更
   - 例外ハンドリングパターンの更新
   - **更新対象**: `coding-rules.md`, `rules-checklist.md`

2. **プロジェクト構造の大規模変更時**
   - 新しいサービスレイヤーの追加
   - ルータ構造の変更
   - データベーススキーマの更新
   - **更新対象**: `coding-rules.md`, `sources.md`

3. **テストポリシーの変更時**
   - テストカバレッジ要件の変更
   - テストツールの更新
   - **更新対象**: `coding-rules.md`, `rules-checklist.md`

4. **セキュリティ要件の更新時**
   - 新しいセキュリティ脆弱性対策
   - 認証/認可パターンの変更
   - **更新対象**: `coding-rules.md`, `rules-checklist.md`

5. **定期的なメンテナンス（推奨：月1回）**
   - 全ドキュメントの整合性確認
   - 新しい禁止事項/推奨事項の反映
   - 文書表現の改善

## 更新手順

### 方法1: Claude Code を使用した更新（推奨）

```bash
# Claude Code で以下をリクエスト：
# "Update AI context documents based on changes to CLAUDE.md and coding-conventions.md"
# または
# ".claude/ ディレクトリのドキュメントを最新の状態に更新してください"
```

Claude Code は以下を自動実行します：
1. ソースドキュメントの変更を検出
2. 関連する AI コンテキストドキュメントを更新
3. `sources.md` の更新日時を記録
4. 変更内容をサマリーで報告

### 方法2: 手動更新

各ドキュメントを直接編集する場合：

#### coding-rules.md の更新
```
手順：
1. 変更されたソースドキュメント（CLAUDE.md, coding-conventions.md等）を確認
2. 該当セクションを識別（例："フォーマッター", "命名規則", "エラーハンドリング"）
3. そのセクションの内容を更新
4. sources.md の対応参照を確認
```

#### rules-checklist.md の更新
```
手順：
1. 新しい規則や要件が coding-rules.md に追加されたか確認
2. チェックリスト項目を追加/削除
3. 各項目のサブアイテムを確認
```

#### sources.md の更新
```
手順：
1. "最終更新日時" セクションを現在の日時に更新
2. 変更されたソースドキュメントを "更新履歴" に追記
3. 新しい参照元がある場合は "参照ドキュメント" に追加
```

## 更新確認チェックリスト

更新後、以下を確認してください：

- [ ] Markdown フォーマットが正しいか（リスト、ヘッダー、コード блок）
- [ ] リンクが存在し正しいか（内部リンク、ファイルパス）
- [ ] 用語の一貫性（翻訳の揺れがないか）
- [ ] セクション番号が正しいか（手動で番号を付けている場合）
- [ ] 古い情報が削除されているか
- [ ] sources.md に参照元が記録されているか
- [ ] 日本語の文法・表現が自然か

## 例：更新シナリオ

### シナリオ1: 新しいテストカバレッジ要件を追加

**変更内容**: `coding-conventions.md` にテストカバレッジを 80% から 85% に引き上げ

**更新対象ファイル**:
1. `coding-rules.md` 
   - "テストポリシー" セクションで「最小カバレッジ: 85%」に変更
2. `rules-checklist.md`
   - "テスト関連" セクションで対応チェック項目を更新
3. `sources.md`
   - "最終更新日時" を更新
   - "更新履歴" に "coding-conventions.md: テストカバレッジ要件を 85% に引き上げ" を追記

### シナリオ2: 新しいフォーマッター導入

**変更内容**: フロントエンドで prettier-plugin-vue を新規導入

**更新対象ファイル**:
1. `coding-rules.md`
   - "フロントエンドフォーマッター" セクションに新しいプラグイン情報を追加
2. `rules-checklist.md`
   - "フォーマッティング確認" にチェック項目を追加
3. `sources.md`
   - "外部ツール・ライブラリ" セクション更新
   - `package.json` への参照を確認

## AI コンテキスト統合確認

Claude Code で以下を実行して、AI コンテキストが正しく統合されているか確認できます：

```
「現在の coding-rules.md の "フォーマッター" セクションを要約してください」
「rules-checklist.md の全チェック項目を一覧で表示してください」
「sources.md から参照されている全ドキュメントを一覧で表示してください」
```

## トラブルシューティング

### 問題: 文書と実装にズレが生じた

**原因**: ソースドキュメント更新後、AI コンテキスト文書が同期されていない

**解決**: 
```bash
# Claude Code に以下をリクエスト：
# "coding-conventions.md を読んで、AI context 文書との差分を確認してください"
```

### 問題: セクション構成が複雑になりすぎた

**原因**: 累積的な更新により、ドキュメント構造が肥大化

**解決**:
```bash
# Claude Code に以下をリクエスト：
# ".claude/ 文書のセクション構成を整理・簡潔化してください"
```

### 問題: 参照ドキュメントが移動/削除された

**原因**: README.md や docs/ 内のファイルが移動・削除

**解決**:
```bash
# Claude Code に以下をリクエスト：
# "sources.md 内の古い参照をすべて確認し、新しいパスに更新してください"
```

## 定期更新スケジュール案

推奨される定期メンテナンス：

| 頻度 | タイミング | 対象 | 作業内容 |
|------|-----------|------|--------|
| **毎週** | 月曜朝 | sources.md | 前週の重要変更を記録 |
| **月1回** | 月末 | 全文書 | 整合性チェック、古い情報削除 |
| **四半期** | 3月末・6月末・9月末・12月末 | 全文書 | 大規模見直し、新セクション追加検討 |
| **年1回** | 1月初旬 | 全文書 | 完全レビュー、大規模リファクタリング |

## 参考資料

- [Claude Code ドキュメント](https://docs.claude.com/en/docs/claude-code)
- [.gitignore の管理](https://git-scm.com/docs/gitignore)
- [プロジェクト CLAUDE.md](../CLAUDE.md)
